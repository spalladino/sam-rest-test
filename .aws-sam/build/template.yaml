AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'sam-rest-test

  Sample SAM Template for sam-rest-test

  '
Globals:
  Function:
    Timeout: 3
Parameters:
  UserPoolName:
    Type: String
    Default: SamRestTestUserPool
  UserPoolClientName:
    Type: String
    Default: SamRestTestUserPoolClient
  Stage:
    Type: String
    Default: Dev
Resources:
  SamRestTestRelayerApi:
    Type: AWS::Serverless::Api
    Properties:
      StageName:
        Ref: Stage
      Cors: '''*'''
      Auth:
        DefaultAuthorizer: SamRestTestAuthorizer
        Authorizers:
          SamRestTestAuthorizer:
            UserPoolArn:
              Fn::GetAtt:
              - SamRestTestUserPool
              - Arn
  SamRestTestRelayerApiFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: SamRestTestRelayerApiFunction
      Handler: lib.handler
      Runtime: nodejs12.x
      Events:
        GetRelayer:
          Type: Api
          Properties:
            Path: /relayers/{relayerId}
            Method: GET
        CreateRelayer:
          Type: Api
          Properties:
            Path: /relayers
            Method: POST
  SamRestTestUserPool:
    Type: AWS::Cognito::UserPool
    Properties:
      UserPoolName:
        Ref: UserPoolName
      Policies:
        PasswordPolicy:
          MinimumLength: 6
          RequireLowercase: false
          RequireNumbers: false
          RequireSymbols: false
          RequireUppercase: false
      UsernameAttributes:
      - email
      Schema:
      - AttributeDataType: String
        Name: email
        Required: false
  SamRestTestUserPoolClient:
    Type: AWS::Cognito::UserPoolClient
    Properties:
      UserPoolId:
        Ref: SamRestTestUserPool
      ClientName:
        Ref: UserPoolClientName
      GenerateSecret: false
Outputs:
  RelayerApiUrl:
    Description: API Gateway endpoint URL for Prod stage for Hello World function
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/${Stage}/
  RelayerApiFunctionArn:
    Description: Relayer API Function ARN
    Value:
      Fn::GetAtt:
      - SamRestTestRelayerApiFunction
      - Arn
  RelayerApiFunctionIamRole:
    Description: Implicit IAM Role created for the function
    Value:
      Fn::GetAtt:
      - SamRestTestRelayerApiFunctionRole
      - Arn
  UserPoolId:
    Value:
      Ref: SamRestTestUserPool
    Description: Id for the user pool
  UserPoolClientId:
    Value:
      Ref: SamRestTestUserPoolClient
